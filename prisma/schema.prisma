generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Exercise {
  id                    Int                    @id @default(autoincrement())
  name                  String                 @unique
  muscleGroup           String
  type                  String
  notes                 String?
  difficulty            String?
  equipment             String?
  imageUrl              String?
  videoUrl              String?
  alternatives          ExerciseAlternative[]  @relation("AlternativeExercises")
  mainExercise          ExerciseAlternative[]  @relation("MainExercise")
  exercisePreferences   ExercisePreference[]
  originalSubstitutions ExerciseSubstitution[] @relation("OriginalExercise")
  substitutedExercises  ExerciseSubstitution[] @relation("SubstitutedExercise")
  personalRecords       PersonalRecord[]
  workoutExercises      WorkoutExercise[]
}

model Workout {
  id                Int                @id @default(autoincrement())
  date              DateTime           @default(now())
  template          String
  notes             String?
  scheduledWorkouts ScheduledWorkout[] @relation("WorkoutScheduledWorkouts")
  exercises         WorkoutExercise[]
  userId            String
  user              User               @relation(fields: [userId], references: [id])

  @@index([userId])
}

model WorkoutExercise {
  id         Int      @id @default(autoincrement())
  workoutId  Int
  exerciseId Int
  order      Int
  notes      String?
  sets       Set[]
  exercise   Exercise @relation(fields: [exerciseId], references: [id])
  workout    Workout  @relation(fields: [workoutId], references: [id])
}

model Set {
  id                Int             @id @default(autoincrement())
  workoutExerciseId Int
  setNumber         Int
  weight            Float
  reps              Int
  rir               Float?
  workoutExercise   WorkoutExercise @relation(fields: [workoutExerciseId], references: [id])
}

model Metric {
  id                 Int      @id @default(autoincrement())
  date               DateTime @default(now())
  weight             Float?
  waist              Float?
  sleep              Float?
  energy             Int?
  stress             Int?
  notes              String?
  armCircumference   Float?
  bodyFatPercentage  Float?
  chestCircumference Float?
  thighCircumference Float?
  userId             String
  user               User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model ExerciseAlternative {
  id             Int      @id @default(autoincrement())
  mainExerciseId Int
  alternativeId  Int
  similarity     Float    @default(1.0)
  alternative    Exercise @relation("AlternativeExercises", fields: [alternativeId], references: [id], onDelete: Cascade)
  mainExercise   Exercise @relation("MainExercise", fields: [mainExerciseId], references: [id], onDelete: Cascade)

  @@unique([mainExerciseId, alternativeId])
  @@index([mainExerciseId])
}

model PersonalRecord {
  id         Int      @id @default(autoincrement())
  exerciseId Int
  weight     Float
  reps       Int
  date       DateTime @default(now())
  workoutId  Int?
  exercise   Exercise @relation(fields: [exerciseId], references: [id])
  userId     String
  user       User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([exerciseId])
  @@index([date])
}

model WorkoutProgram {
  id                  Int                  @id @default(autoincrement())
  name                String
  description         String?
  isActive            Boolean              @default(true)
  startDate           DateTime             @default(now())
  endDate             DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  equipmentAvailable  Json?
  focusMuscleGroups   Json?
  objectives          Json?
  preferences         Json?
  trainingDaysPerWeek Int?
  exercisePreferences ExercisePreference[]
  weeks               ProgramWeek[]
  scheduledWorkouts   ScheduledWorkout[]
}

model ScheduledWorkout {
  id                    Int                    @id @default(autoincrement())
  programId             Int
  template              String
  dayOfWeek             Int
  weekNumber            Int
  order                 Int
  isCompleted           Boolean                @default(false)
  completedAt           DateTime?
  workoutId             Int?
  exerciseSubstitutions ExerciseSubstitution[]
  program               WorkoutProgram         @relation(fields: [programId], references: [id], onDelete: Cascade)
  workout               Workout?               @relation("WorkoutScheduledWorkouts", fields: [workoutId], references: [id])

  @@index([programId])
  @@index([dayOfWeek])
  @@index([weekNumber])
}

model ProgramWeek {
  id               Int            @id @default(autoincrement())
  programId        Int
  weekNumber       Int
  startDate        DateTime
  endDate          DateTime
  validSetsByGroup Json
  omsStatus        Json
  program          WorkoutProgram @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@unique([programId, weekNumber])
  @@index([programId])
  @@index([startDate])
}

model ExercisePreference {
  id         Int            @id @default(autoincrement())
  programId  Int
  exerciseId Int
  preference String
  reason     String?
  createdAt  DateTime       @default(now())
  exercise   Exercise       @relation(fields: [exerciseId], references: [id], onDelete: Cascade)
  program    WorkoutProgram @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@unique([programId, exerciseId])
  @@index([programId])
  @@index([exerciseId])
}

model ExerciseSubstitution {
  id                    Int              @id @default(autoincrement())
  scheduledWorkoutId    Int
  originalExerciseId    Int
  substitutedExerciseId Int
  reason                String?
  createdAt             DateTime         @default(now())
  originalExercise      Exercise         @relation("OriginalExercise", fields: [originalExerciseId], references: [id], onDelete: Cascade)
  scheduledWorkout      ScheduledWorkout @relation(fields: [scheduledWorkoutId], references: [id], onDelete: Cascade)
  substitutedExercise   Exercise         @relation("SubstitutedExercise", fields: [substitutedExerciseId], references: [id], onDelete: Cascade)

  @@index([scheduledWorkoutId])
  @@index([originalExerciseId])
  @@index([substitutedExerciseId])
}

// Adicione isso no schema.prisma

model User {
  id              String           @id @default(cuid())
  name            String?
  email           String           @unique
  emailVerified   DateTime?
  image           String?
  accounts        Account[]
  sessions        Session[]
  workouts        Workout[]
  metrics         Metric[]
  personalRecords PersonalRecord[]
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
